<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repos</title>
    <style>
        body {
            background-color: #121212;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .title {
            font-size: 2em;
            margin-bottom: 20px;
        }
        .repo, .changelog {
            background-color: #1e1e1e;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            color: #FFFFFF;
            background-color: #333;
            text-decoration: none;
            border-radius: 5px;
            margin-right: 10px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #555;
        }
        .changelog {
            display: block;
        }
        .repo-content, .folder-content, .commit-details {
            display: none;
            margin-left: 20px;
        }
        .folder, .file, .changelog-entry {
            cursor: pointer;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
    <!-- Include the Showdown library from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="title">GitHub Repos</h1>
        <div id="repos"></div>
        <h1 class="title">Changelogs</h1>
        <div id="changelogs"></div>
    </div>

    <script>
        const GITHUB_TOKEN = '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';
        const GITHUB_USERNAME = 'SFYMMIK';  // Replace with your GitHub username

        async function fetchRepos() {
            const response = await fetch(`https://api.github.com/users/${GITHUB_USERNAME}/repos`, {
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`
                }
            });
            const repos = await response.json();
            displayRepos(repos);
        }

        function displayRepos(repos) {
            const reposContainer = document.getElementById('repos');
            reposContainer.innerHTML = '';
            repos.forEach(repo => {
                const repoDiv = document.createElement('div');
                repoDiv.classList.add('repo');
                repoDiv.innerHTML = `
                    <h2 class="repo-title">${repo.name}</h2>
                    <p>${repo.description}</p>
                    <div class="repo-content" id="content-${repo.name}"></div>
                `;
                repoDiv.querySelector('.repo-title').onclick = () => toggleRepoContent(repo.name);
                reposContainer.appendChild(repoDiv);
            });
        }

        async function toggleRepoContent(repoName) {
            const contentDiv = document.getElementById(`content-${repoName}`);
            if (contentDiv.style.display === 'block') {
                contentDiv.style.display = 'none';
            } else {
                contentDiv.style.display = 'block';
                if (contentDiv.innerHTML === '') {
                    await fetchRepoContent(repoName, '', contentDiv);
                    await fetchReadme(repoName, contentDiv);
                }
            }
        }

        async function fetchRepoContent(repoName, path, container) {
            const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${repoName}/contents/${path}`, {
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`
                }
            });
            const contents = await response.json();
            container.innerHTML = '';
            contents.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add(item.type === 'dir' ? 'folder' : 'file');
                itemDiv.innerText = item.name;
                itemDiv.onclick = async () => {
                    if (item.type === 'dir') {
                        const folderContentDiv = document.createElement('div');
                        folderContentDiv.classList.add('folder-content');
                        itemDiv.appendChild(folderContentDiv);
                        await fetchRepoContent(repoName, item.path, folderContentDiv);
                        folderContentDiv.style.display = 'block';
                    } else if (item.name.endsWith('.md')) {
                        await fetchMarkdownFile(repoName, item.path, itemDiv);
                    } else {
                        window.open(item.download_url, '_blank');
                    }
                };
                container.appendChild(itemDiv);
            });
        }

        async function fetchMarkdownFile(repoName, path, container) {
            const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${repoName}/contents/${path}`, {
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Accept': 'application/vnd.github.v3.raw'
                }
            });
            if (response.status === 200) {
                const markdownContent = await response.text();
                const converter = new showdown.Converter();
                const htmlContent = converter.makeHtml(markdownContent);
                const markdownDiv = document.createElement('div');
                markdownDiv.classList.add('markdown');
                markdownDiv.innerHTML = `<div>${htmlContent}</div>`;
                container.appendChild(markdownDiv);
            }
        }

        async function fetchReadme(repoName, container) {
            const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${repoName}/readme`, {
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Accept': 'application/vnd.github.v3.raw'
                }
            });
            if (response.status === 200) {
                const readmeContent = await response.text();
                const converter = new showdown.Converter();
                const htmlContent = converter.makeHtml(readmeContent);
                const readmeDiv = document.createElement('div');
                readmeDiv.classList.add('readme');
                readmeDiv.innerHTML = `<h3>README.md</h3><div>${htmlContent}</div>`;
                container.appendChild(readmeDiv);
            }
        }

        async function fetchChangelogs() {
            const response = await fetch(`https://api.github.com/users/${GITHUB_USERNAME}/events`, {
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`
                }
            });
            const events = await response.json();
            displayChangelogs(events);
        }

        function displayChangelogs(events) {
            const changelogsContainer = document.getElementById('changelogs');
            changelogsContainer.innerHTML = '';
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            const pushEvents = events.filter(event => event.type === 'PushEvent' && new Date(event.created_at) >= threeMonthsAgo);
            pushEvents.forEach(event => {
                event.payload.commits.forEach(commit => {
                    const changelogDiv = document.createElement('div');
                    changelogDiv.classList.add('changelog');
                    changelogDiv.setAttribute('data-repo', event.repo.name);
                    changelogDiv.innerHTML = `
                        <h2 class="changelog-entry">${event.repo.name}</h2>
                        <p>${commit.message}</p>
                        <p><small>${new Date(event.created_at).toLocaleString()}</small></p>
                        <div class="commit-details" id="details-${commit.sha}"></div>
                    `;
                    changelogDiv.querySelector('.changelog-entry').onclick = () => toggleCommitDetails(event.repo.name, commit.sha);
                    changelogsContainer.appendChild(changelogDiv);
                });
            });
        }

        async function toggleCommitDetails(repoName, commitSha) {
            const detailsDiv = document.getElementById(`details-${commitSha}`);
            if (detailsDiv.style.display === 'block') {
                detailsDiv.style.display = 'none';
            } else {
                detailsDiv.style.display = 'block';
                if (detailsDiv.innerHTML === '') {
                    await fetchCommitDetails(repoName, commitSha, detailsDiv);
                }
            }
        }

        async function fetchCommitDetails(repoName, commitSha, container) {
            const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${repoName}/commits/${commitSha}`, {
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`
                }
            });
            const commit = await response.json();
            container.innerHTML = `
                <h3>Files Changed:</h3>
                ${commit.files.map(file => `
                    <div>
                        <strong>${file.filename}</strong> - ${file.status}
                    </div>
                `).join('')}
            `;
        }

        function autoUpdate() {
            fetchRepos();
            fetchChangelogs();
        }

        window.onload = () => {
            autoUpdate();
            setInterval(autoUpdate, 180000); // Update every 3 minutes
        }
    </script>
</body>
</html>
